(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{48:function(e,t,n){},69:function(e,t,n){},82:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var s=n(0),r=n.n(s),a=n(40),c=n.n(a),i=(n(48),n(23)),o=n(5),u=n(7),l=n.n(u),m=n(13),p=n(28),d=n(9),j=n(20),f=n.n(j),h="https://www.eventsourcechat.herokuapp.com/",b="CHAT_MESSAGE",g="USER_JOINED",O="USER_LEFT",x=[];function v(e){return y.apply(this,arguments)}function y(){return(y=Object(m.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post("".concat(h,"/login/"),{name:t});case 3:return n=e.sent,e.abrupt("return",{status:!0,message:n.data.message,name:n.data.name});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{status:!1,message:e.t0.response.data.message||"something went wrong :("});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function w(){return(w=Object(m.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post("".concat(h,"/message/send?user=").concat(t),{message:n});case 3:e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0.response);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function N(){return S.apply(this,arguments)}function S(){return(S=Object(m.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.get("".concat(h,"/message/userList?user=admin"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function E(){return k.apply(this,arguments)}function k(){return(k=Object(m.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.get("".concat(h,"/message/history?user=admin"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var C=function(){};function L(){return L=Object(m.a)(l.a.mark((function e(t){var n,s,r,a,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:C,s=c.length>2&&void 0!==c[2]?c[2]:C,r=c.length>3&&void 0!==c[3]?c[3]:C,a=c.length>4&&void 0!==c[4]?c[4]:C,x[0]&&x[0].close(),x[0]=new EventSource("".concat(h,"/message/stream?user=").concat(t)),x[0].onopen=function(){console.log("EventStream opened")},x[0].addEventListener(g,(function(e){e=JSON.parse(e.data),s(e.username,e.time)})),x[0].addEventListener(O,(function(e){e=JSON.parse(e.data),console.log("User ".concat(e.username," left!")),r(e.username,e.time)})),x[0].addEventListener(b,(function(e){e=JSON.parse(e.data),n(e.username,e.message,e.time)})),x[0].onerror=function(e){console.log("Error\n",e),x[0].close(),a()},e.abrupt("return",(function(){x[0].close()}));case 12:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}var M=n(1),U=Object(s.createContext)("");var J=function(e){var t=Object(s.useState)(),n=Object(d.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)([]),i=Object(d.a)(c,2),o=i[0],u=i[1],j=Object(s.useState)([]),f=Object(d.a)(j,2),h=f[0],b=f[1],g=function(){var e=Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=b,e.t1=p.a,e.next=4,N();case 4:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(m.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u,e.next=3,E();case 3:e.t1=e.sent,(0,e.t0)(e.t1),console.log("Got history");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(M.jsx)(U.Provider,{value:{username:r,setUsername:a,messages:o,setMessages:u,addMessage:function(e){o.push(e),u(Object(p.a)(o))},users:h,requestUsers:g,clearMessages:function(){u([])},requestHistory:O},children:e.children})},q=n(86),B=n(85),R=n(87);n(69);var z=function(e){var t=Object(o.f)(),n=Object(s.useContext)(U),r=Object(s.useRef)(null),a=function(e,t,s){n.addMessage({username:e,message:t,time:s})},c=function(e,t){n.addMessage({username:"Server",message:"".concat(e," left"),time:t}),n.requestUsers()},i=function(e,t){n.addMessage({username:"Server",message:"".concat(e," joined"),time:t}),n.requestUsers()},u=function(){t("/")};return Object(s.useEffect)((function(){!function(e){L.apply(this,arguments)}(n.username,a,i,c,u)}),[]),Object(M.jsxs)("div",{className:"chat",children:[Object(M.jsxs)(q.a,{body:!0,style:{textAlign:"left",marginBottom:"0.5em"},children:["Logged in as"," ",Object(M.jsx)("span",{style:{fontWeight:"bold"},children:n.username})]}),Object(M.jsxs)("div",{className:"content",children:[Object(M.jsxs)("div",{className:"message-area",children:[Object(M.jsx)("div",{className:"history-wrapper",children:Object(M.jsx)("div",{className:"history",children:n.messages.map((function(e,t){return Object(M.jsx)(q.a,{className:"msg",children:Object(M.jsxs)(q.a.Body,{children:[Object(M.jsxs)("span",{className:"msg-sender",children:[e.username,":"]}),Object(M.jsxs)("span",{className:"msg-body",children:[" ",e.message]}),Object(M.jsxs)("span",{className:"time",children:[new Date(e.time).toLocaleTimeString()," "]})]})},t)}))})}),Object(M.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[Object(M.jsx)(B.a.Control,{as:"textarea",placeholder:"Write your message here",style:{height:"100px"},className:"messagebox",ref:r}),Object(M.jsx)(R.a,{className:"send",onClick:function(){!function(e,t){w.apply(this,arguments)}(n.username,r.current.value),r.current.value=""},children:"Send!"})]})]}),Object(M.jsxs)("ul",{className:"online list-group",children:[Object(M.jsx)("span",{className:"online-label",children:"Online"}),n.users.map((function(e,t){return Object(M.jsx)("li",{className:"list-group-item",children:e.name},t)}))]})]})]})},G=n(27),H=n.n(G),T=(n(82),n(88)),A=n(41);function D(e){H.a.fire({icon:"success",title:"Hooray!",text:e,showConfirmButton:!1,timer:1500})}function _(e){H.a.fire({icon:"error",title:"Oops!",text:e,showConfirmButton:!1,timer:1500})}var I=function(e){var t=Object(s.useRef)(null),n=Object(s.useContext)(U),r=Object(o.f)(),a=Object(o.e)();Object(s.useEffect)((function(){console.log(x[0]),x[0]&&(x[0].close(),x[0]=void 0,console.log("Closed"))}),[a]);var c=function(){var e=Object(m.a)(l.a.mark((function e(s){var a,c,i,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current.value,e.next=3,v(a);case 3:if(c=e.sent,i=c.status,o=c.message,u=c.name,i?D(o):_(o),!i){e.next=13;break}return n.setUsername(u),e.next=12,n.requestHistory();case 12:r("/chat");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(M.jsxs)("div",{className:"login",children:[Object(M.jsx)("span",{className:"title card-title",children:"Chat Room!"}),Object(M.jsxs)(T.a,{size:"lg",id:"inputGroup-sizing-sm",className:"mb-3 name-input login-elm",placeholder:"Enter Login Name",children:[Object(M.jsx)(T.a.Text,{children:"Login Name:"}),Object(M.jsx)(A.a,{"aria-label":"Small","aria-describedby":"inputGroup-sizing-sm",ref:t})]}),Object(M.jsx)("div",{className:"btn-container login-elm",children:Object(M.jsx)(R.a,{id:"login-btn",size:"lg",onClick:c,children:"Login"})})]})};var W=function(){return Object(M.jsx)(J,{children:Object(M.jsx)(i.a,{children:Object(M.jsxs)(o.c,{children:[Object(M.jsx)(o.a,{path:"/",element:Object(M.jsx)(I,{})}),Object(M.jsx)(o.a,{path:"/chat",element:Object(M.jsx)(z,{})})]})})})};n(83);c.a.render(Object(M.jsx)(r.a.StrictMode,{children:Object(M.jsx)(W,{})}),document.getElementById("root"))}},[[84,1,2]]]);
//# sourceMappingURL=main.86775d2e.chunk.js.map